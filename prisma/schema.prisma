// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String?
  avatar        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  watchlist     WatchlistItem[]
  continueWatching ContinueWatchingItem[]
  ratings       Rating[]
  preferences   UserPreferences?
}

model UserPreferences {
  id            String   @id @default(cuid())
  userId        String   @unique
  favoriteGenres String  // JSON string of genre array
  language      String   @default("en")
  autoplay      Boolean  @default(true)
  parentalControl Boolean @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Content {
  id            Int      @id // TMDB ID
  tmdbId        Int      @unique
  title         String
  overview      String?
  posterPath    String?
  backdropPath  String?
  releaseDate   DateTime?
  firstAirDate  DateTime?
  voteAverage   Float?
  voteCount     Int?
  contentType   String   // "movie" or "tv"
  genres        String   // JSON string of genre array
  runtime       Int?     // in minutes
  adult         Boolean  @default(false)
  originalLanguage String @default("en")
  popularity    Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  watchlist     WatchlistItem[]
  continueWatching ContinueWatchingItem[]
  ratings       Rating[]
}

model WatchlistItem {
  id            String   @id @default(cuid())
  userId        String
  contentId     Int
  addedAt       DateTime @default(now())
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  content       Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  @@unique([userId, contentId])
}

model ContinueWatchingItem {
  id            String   @id @default(cuid())
  userId        String
  contentId     Int
  watchedAt     DateTime @default(now())
  progress      Float    @default(0) // Progress percentage (0-100)
  season        Int?     // For TV shows
  episode       Int?     // For TV shows
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  content       Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  @@unique([userId, contentId])
}

model Rating {
  id            String   @id @default(cuid())
  userId        String
  contentId     Int
  rating        Float    // 1-10 scale
  review        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  content       Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  @@unique([userId, contentId])
}